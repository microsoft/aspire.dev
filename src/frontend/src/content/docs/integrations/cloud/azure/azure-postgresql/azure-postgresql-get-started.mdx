---
title: Get started with the Azure PostgreSQL integrations
description: Learn how to set up the Aspire Azure PostgreSQL Hosting and Client integrations simply.
---

import { Image } from 'astro:assets';
import InstallPackage from '@components/InstallPackage.astro';
import InstallDotNetPackage from '@components/InstallDotNetPackage.astro';
import { Aside, CardGrid, LinkCard } from '@astrojs/starlight/components';
import PivotSelector from '@components/PivotSelector.astro';
import Pivot from '@components/Pivot.astro';
import postgresqlIcon from '@assets/icons/azure-postgresql-icon.png';

<Image
  src={postgresqlIcon}
  alt="Azure Database for PostgreSQL logo"
  height={80}
  width={80}
  class:list={'float-inline-left icon'}
  data-zoom-off
/>

[Azure Database for PostgreSQL](https://learn.microsoft.com/azure/postgresql/)—Flexible Server is a relational database service based on the open-source Postgres database engine. It's a fully managed database-as-a-service that can handle mission-critical workloads with predictable performance, security, high availability, and dynamic scalability. The Aspire Azure PostgreSQL integration provides a way to connect to existing Azure PostgreSQL databases, or create new instances from .NET with the [`docker.io/library/postgres` container image](https://hub.docker.com/_/postgres).

In this introduction, you'll see how to install and use the Aspire Azure PostgreSQL integrations in a simple configuration. If you already have this knowledge, see [Azure PostgreSQL Hosting integration](/integrations/cloud/azure/azure-postgresql/azure-postgresql-host/) for full reference details.

<Aside type="note">
    To follow this guide, you must have created an Aspire solution to work with. To learn how to do that, see [Build your first Aspire app](/get-started/first-app/).
</Aside>

## Set up hosting integration

To begin, install the Aspire Azure PostgreSQL Hosting integration in your Aspire AppHost project. This integration allows you to create and manage Azure PostgreSQL database instances from your Aspire hosting projects:

<InstallPackage packageName="Aspire.Hosting.Azure.PostgreSQL" shortName="azure-postgresql" />

Next, in the AppHost project, create instances of Azure PostgreSQL server and database resources, then pass the database to the consuming client projects:

<PivotSelector
    title="Select your programming language to get started"
    key="lang"
    options={[
        { id: "csharp", title: "C#" },
        { id: "python", title: "Python" },
        { id: "javascript", title: "JavaScript" },
    ]}
/>

<Pivot id="csharp">

```csharp title="C# — AppHost.cs"
var builder = DistributedApplication.CreateBuilder(args);

var postgres = builder.AddAzurePostgresFlexibleServer("postgres");
var postgresdb = postgres.AddDatabase("postgresdb");

var exampleProject = builder.AddProject<Projects.ExampleProject>("apiservice")
                            .WaitFor(postgresdb)
                            .WithReference(postgresdb);

builder.Build().Run();
```

</Pivot>

<Pivot id="python">

```csharp title="C# — AppHost.cs"
var builder = DistributedApplication.CreateBuilder(args);

var postgres = builder.AddAzurePostgresFlexibleServer("postgres");
var postgresdb = postgres.AddDatabase("postgresdb");

var exampleProject = builder.AddUvicornApp("api", "./api", "main:app")
                            .WithExternalHttpEndpoints()
                            .WaitFor(postgresdb)
                            .WithReference(postgresdb);

builder.Build().Run();
```

</Pivot>

<Pivot id="javascript">

```csharp title="C# — AppHost.cs"
var builder = DistributedApplication.CreateBuilder(args);

var postgres = builder.AddAzurePostgresFlexibleServer("postgres");
var postgresdb = postgres.AddDatabase("postgresdb");

var api = builder.AddNodeApp("api", "./api", scriptPath: "index.js")
                 .WithExternalHttpEndpoints()
                 .WaitFor(postgresdb)
                 .WithReference(postgresdb);

builder.Build().Run();
```

</Pivot>

<Aside type="caution">
  When you call `AddAzurePostgresFlexibleServer`, it implicitly calls `AddAzureProvisioning`—which adds support for generating Azure resources dynamically during app startup. The app must configure the appropriate subscription and location. For more information, see [Local provisioning: Configuration](/integrations/cloud/azure/local-provisioning/#configuration).
</Aside>

<Aside type="tip">
    This is the simplest implementation of Azure PostgreSQL resources in the AppHost. There are many more options you can choose from to address your requirements. For full details, see [Azure PostgreSQL Hosting integration](/integrations/cloud/azure/azure-postgresql/azure-postgresql-host/).
</Aside>

## Use the integration in client projects

Now that the hosting integration is ready, the next step is to install and configure the client integration in any projects that need to use it.

### Set up client projects

<Pivot id="csharp">

In each of these consuming client projects, install the Aspire Azure PostgreSQL client integration:

<InstallDotNetPackage packageName="Aspire.Azure.Npgsql" />

In the `Program.cs` file of your client-consuming project, call the `AddAzureNpgsqlDataSource` extension method on any `IHostApplicationBuilder` to register an `NpgsqlDataSource` for use via the dependency injection container. The method takes a connection name parameter.

```csharp title="C# — Program.cs"
builder.AddAzureNpgsqlDataSource(connectionName: "postgresdb");
```

<Aside type="tip">
    The `connectionName` parameter must match the name used when adding the Azure PostgreSQL database resource in the AppHost project. For more information, see [Set up hosting integration](#set-up-hosting-integration).
</Aside>

</Pivot>

<Pivot id="python">

To interact with Azure PostgreSQL databases in your Python consuming projects, you need to include a PostgreSQL adapter library. Two popular options are `psycopg` (synchronous) and `asyncpg` (asynchronous). You can install either of these libraries using pip. In this article, example code uses `psycopg`:

```bash
pip install psycopg[binary]
```

Ensure that you `import psycopg` in code files that interact with the database. You should also import the `os` module to access environment variables:

```python title="Python — Import psycopg"
import psycopg
import os
```

</Pivot>

<Pivot id="javascript">

To interact with Azure PostgreSQL databases in your JavaScript consuming projects, you need to include a PostgreSQL client library. A popular option is `pg`. You can install this library using npm:

```bash
npm install pg
```

Ensure that you `import pg` in code files that interact with the database:

```javascript title="JavaScript — Import pg"
import pg from 'pg';
```

</Pivot>

### Use injected Azure PostgreSQL properties

In the AppHost, when you used the `WithReference` method to pass an Azure PostgreSQL server or database resource to a consuming client project, Aspire injects several configuration properties that you can use in the consuming project.

Aspire exposes each property as an environment variable named `[RESOURCE]_[PROPERTY]`. For instance, the `Uri` property of a resource called `postgresdb` becomes `POSTGRESDB_URI`.

<Pivot id="csharp">

Use the `GetValue()` method to obtain these environment variables in consuming projects:

```csharp title="C# — Obtain configuration properties"
string hostname = builder.Configuration.GetValue<string>("POSTGRESDB_HOST");
string databaseport = builder.Configuration.GetValue<string>("POSTGRESDB_PORT");
string jdbcconnectionstring = builder.Configuration.GetValue<string>("POSTGRESDB_JDBCCONNECTIONSTRING");
string databasename = builder.Configuration.GetValue<string>("POSTGRESDB_DATABASENAME");
```

</Pivot>

<Pivot id="python">

Use the `os.getenv()` method to obtain these environment variables in consuming projects:

```python title="Python — Obtain configuration properties"
postgres_uri = os.getenv("POSTGRESDB_URI")
postgres_name = os.getenv("POSTGRESDB_DATABASENAME", "db")
```

</Pivot>

<Pivot id="javascript">

Use the `process.env` object to obtain these environment variables in consuming projects:

```javascript title="JavaScript — Obtain configuration properties"
const pghost = process.env.POSTGRESDB_HOST;
const pgport = process.env.POSTGRESDB_PORT;
const pgdatabase = process.env.POSTGRESDB_DATABASENAME;
// Note: When using Microsoft Entra ID (default), username and password are not used
```

</Pivot>

<Aside type="tip">
    The full set of properties that Aspire injects depends on whether you passed an Azure PostgreSQL server or database resource. For more information, see [Properties of the Azure PostgreSQL resources](/integrations/cloud/azure/azure-postgresql/azure-postgresql-client/#properties-of-the-azure-postgresql-resources).
</Aside>

### Use Azure PostgreSQL resources in client code

<Pivot id="csharp">

Now that you've added `NpgsqlDataSource` to the builder in the consuming project, you can use the Azure PostgreSQL resource to get and store data. Get the `NpgsqlDataSource` instance using dependency injection. For example, to retrieve your data source object from an example service define it as a constructor parameter and ensure the `ExampleService` class is registered with the dependency injection container:

```csharp title="C# — ExampleService.cs"
public class ExampleService(NpgsqlDataSource dataSource)
{
    // Use dataSource to query the database...
}
```

Having obtained the data source, you can work with the Azure PostgreSQL database as you would in any other C# application.

</Pivot>

<Pivot id="python">

Use the information you have obtained about the Azure PostgreSQL resource to connect to the database. Here is an example of how to connect using `psycopg`:

```python title="Python — Connect to Azure PostgreSQL"
async with await psycopg.AsyncConnection.connect(postgres_uri, autocommit=True) as conn:
    # Use connection to query the database...
```

Having obtained the connection, you can work with the Azure PostgreSQL database as you would in any other Python application.

</Pivot>

<Pivot id="javascript">

Use the information you have obtained about the Azure PostgreSQL resource to connect to the database. Here is an example of how to connect using `pg`:

```javascript title="JavaScript — Connect to Azure PostgreSQL"
const client = new pg.Client({
  host: pghost,
  database: pgdatabase,
  port: pgport,
  // Note: When using Microsoft Entra ID (default), configure Azure authentication
});

client.connect();
```

Having obtained the connection, you can work with the Azure PostgreSQL database as you would in any other JavaScript application.

</Pivot>

## Next steps

Now, that you have an Aspire app with Azure PostgreSQL integrations up and running, you can use the following reference documents to learn how to configure and interact with the Azure PostgreSQL resources:

<CardGrid>
  <LinkCard
    title="Understand the Azure PostgreSQL hosting integration"
    description="Discover how to configure password authentication, run as container, and more."
    href="/integrations/cloud/azure/azure-postgresql/azure-postgresql-host/"
  />
  <LinkCard
    title="Understand the Azure PostgreSQL client integration"
    description="Discover how to configure keyed clients, observability, and more."
    href="/integrations/cloud/azure/azure-postgresql/azure-postgresql-client/"
  />
</CardGrid>
