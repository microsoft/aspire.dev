---
title: Azure Table Storage
description: Learn how to use the Azure Table Storage integration to store structured NoSQL data in Azure Storage tables.
---

import InstallPackage from '@components/InstallPackage.astro';
import InstallDotNetPackage from '@components/InstallDotNetPackage.astro';
import { Aside } from '@astrojs/starlight/components';
import { Image } from 'astro:assets';
import tableIcon from '@assets/icons/azure-table-icon.png';

<Image
  src={tableIcon}
  alt="Azure Table Storage logo"
  width={100}
  height={100}
  class:list={'float-inline-left icon'}
  data-zoom-off
/>

[Azure Table Storage](https://learn.microsoft.com/azure/storage/tables/table-storage-overview) is a service that stores structured NoSQL data in the cloud, providing a key/attribute store with a schemaless design. The Aspire Azure Table Storage integration enables you to connect to existing Azure Storage instances or create new instances from applications with the [`mcr.microsoft.com/azure-storage/azurite` container image](https://mcr.microsoft.com/product/azure-storage/azurite/about).

## Hosting integration

The Azure Table Storage hosting integration models an Azure Storage resource as the `AzureStorageResource` type. To access this type and APIs, add the [ðŸ“¦ Aspire.Hosting.Azure.Storage](https://www.nuget.org/packages/Aspire.Hosting.Azure.Storage) NuGet package in your AppHost project:

<InstallPackage packageName="Aspire.Hosting.Azure.Storage" shortName="azure-storage" />

### Add Azure Table Storage resource

In your AppHost project, register the Azure Table Storage integration by chaining a call to `AddTables` on the `IResourceBuilder<IAzureStorageResource>` instance returned by `AddAzureStorage`. The following example demonstrates how to add an Azure Table Storage resource:

```csharp
var builder = DistributedApplication.CreateBuilder(args);

var tables = builder.AddAzureStorage("storage")
                    .RunAsEmulator()
                    .AddTables("tables");

builder.AddProject<Projects.ExampleProject>()
       .WithReference(tables)
       .WaitFor(tables);

// After adding all resources, run the app...
```

The preceding code:

- Adds an Azure Storage resource named `storage`.
- Chains a call to `RunAsEmulator` to configure the storage resource to run locally using [Azurite](https://learn.microsoft.com/storage/common/storage-use-azurite).
- Adds a table storage resource named `tables` to the storage resource.
- Adds the `tables` resource to the `ExampleProject` and waits for it to be ready before starting the project.

For more information on Azure Storage hosting integration including Bicep generation, emulator configuration, and health checks, see [Azure Blob Storage](/integrations/cloud/azure-storage-blobs/).

## Client integration

To get started with the Aspire Azure Table Storage client integration, install the [ðŸ“¦ Aspire.Azure.Data.Tables](https://www.nuget.org/packages/Aspire.Azure.Data.Tables) NuGet package:

<InstallDotNetPackage packageName="Aspire.Azure.Data.Tables" />

### Add Azure Table Storage client

In the `Program.cs` file of your client-consuming project, call the `AddAzureTableClient` extension method to register a `TableServiceClient` for dependency injection. The method takes a connection name parameter:

```csharp
builder.AddAzureTableClient("tables");
```

You can then retrieve the `TableServiceClient` instance using dependency injection:

```csharp
public class ExampleService(TableServiceClient client)
{
    // Use client...
}
```

### Configuration

The Azure Table Storage integration provides multiple options to configure the `TableServiceClient`.

#### Use configuration providers

The Azure Table Storage integration supports `Microsoft.Extensions.Configuration`. It loads the `AzureDataTablesSettings` and `TableClientOptions` from configuration using the `Aspire:Azure:Data:Tables` key. Example `appsettings.json`:

```json
{
  "Aspire": {
    "Azure": {
      "Data": {
        "Tables": {
          "ServiceUri": "YOUR_URI",
          "DisableHealthChecks": true,
          "DisableTracing": false,
          "ClientOptions": {
            "EnableTenantDiscovery": true
          }
        }
      }
    }
  }
}
```

#### Use named configuration

The Azure Table Storage integration supports named configuration for multiple instances:

```json
{
  "Aspire": {
    "Azure": {
      "Data": {
        "Tables": {
          "tables1": {
            "ServiceUri": "https://myaccount1.table.core.windows.net/",
            "DisableHealthChecks": true,
            "ClientOptions": {
              "EnableTenantDiscovery": true
            }
          },
          "tables2": {
            "ServiceUri": "https://myaccount2.table.core.windows.net/",
            "DisableTracing": true,
            "ClientOptions": {
              "EnableTenantDiscovery": false
            }
          }
        }
      }
    }
  }
}
```

Use the connection names when calling `AddAzureTableClient`:

```csharp
builder.AddAzureTableClient("tables1");
builder.AddAzureTableClient("tables2");
```

#### Use inline delegates

You can also pass the `Action<AzureDataTablesSettings>` delegate to set up options inline:

```csharp
builder.AddAzureTableClient(
    "tables",
    settings => settings.DisableHealthChecks = true);
```

You can also configure the `TableClientOptions`:

```csharp
builder.AddAzureTableClient(
    "tables",
    configureClientBuilder: clientBuilder =>
        clientBuilder.ConfigureOptions(
            options => options.EnableTenantDiscovery = true));
```

### Client integration health checks

By default, Aspire integrations enable health checks for all services. The Azure Table Storage integration:

- Adds the health check when `DisableHealthChecks` is `false`, which attempts to connect to the Azure Table Storage.
- Integrates with the `/health` HTTP endpoint, which specifies all registered health checks must pass for app to be considered ready to accept traffic.

### Observability and telemetry

#### Logging

The Azure Table Storage integration uses the following log categories:

- `Azure.Core`
- `Azure.Identity`

#### Tracing

The Azure Table Storage integration emits the following tracing activities using OpenTelemetry:

- `Azure.Data.Tables.TableServiceClient`

#### Metrics

The Azure Table Storage integration currently doesn't support metrics by default due to limitations with the Azure SDK.
