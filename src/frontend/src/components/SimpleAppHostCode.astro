---
import { Code } from '@astrojs/starlight/components';
import type { MarkerDefinition } from '@astrojs/starlight/expressive-code';
import Pivot from '@components/Pivot.astro';

export type MarkerValueType = MarkerDefinition | MarkerDefinition[] | undefined;
export type CollapseValueType = string | string[] | undefined;

interface CodeProps {
  mark?: MarkerValueType;
  collapse?: CollapseValueType;
}

const { mark, collapse } = Astro.props as CodeProps;

const csharp = `
var builder = DistributedApplication.CreateBuilder(args);

// Add database resource
var postgres = builder.AddPostgres("db")
    .AddDatabase("appdata")
    .WithDataVolume();

// Add API service and reference the database
var api = builder.AddProject<Projects.Api>("api")
    .WithReference(postgres)
    .WaitFor(postgres);

// Add frontend service and reference the API
builder.AddViteApp("frontend", "../frontend")
    .WithHttpEndpoint(env: "PORT")
    .WithReference(api);

builder.Build().Run();
`;

const python = `
var builder = DistributedApplication.CreateBuilder(args);

// Add database resource
var postgres = builder.AddPostgres("db")
    .AddDatabase("appdata")
    .WithDataVolume();

// Add API service and reference the database
var api = builder.AddUvicornApp("api", "../api", "main:app")
    .WithUv().WithReference(postgres)
    .WaitFor(postgres);

// Add frontend service and reference the API
builder.AddViteApp("frontend", "../frontend")
    .WithHttpEndpoint(env: "PORT")
    .WithReference(api);

builder.Build().Run();
`;

const javascript = `
var builder = DistributedApplication.CreateBuilder(args);

// Add database resource
var postgres = builder.AddPostgres("db")
    .AddDatabase("appdata")
    .WithDataVolume();

// Add API service and reference the database
var api = builder.AddNodeApp("api", "../api", "server.js")
    .WithNpm().WithReference(postgres)
    .WaitFor(postgres);

// Add frontend service and reference the API
builder.AddViteApp("frontend", "../frontend")
    .WithHttpEndpoint(env: "PORT")
    .WithReference(api);

builder.Build().Run();
`;

const golang = `
var builder = DistributedApplication.CreateBuilder(args);

// Add database resource
var postgres = builder.AddPostgres("db")
    .AddDatabase("appdata")
    .WithDataVolume();

// Add API service and reference the database
var api = builder.AddGolangApp("api", "../api")
    .WithHttpEndpoint(env: "PORT")
    .WithReference(postgres)
    .WaitFor(postgres);

// Add frontend service and reference the API
builder.AddViteApp("frontend", "../frontend")
    .WithHttpEndpoint(env: "PORT")
    .WithReference(api);

builder.Build().Run();
`;

const java = `
var builder = DistributedApplication.CreateBuilder(args);

// Add database resource
var postgres = builder.AddPostgres("db")
    .AddDatabase("appdata")
    .WithDataVolume();

// Add API service and reference the database
var api = builder.AddSpringApp("api", "../api", "../agents/opentelemetry-javaagent.jar")
    .WithHttpEndpoint(port: 8080)
    .WithReference(postgres)
    .WaitFor(postgres);

// Add frontend service and reference the API
builder.AddViteApp("frontend", "../frontend")
    .WithHttpEndpoint(env: "PORT")
    .WithReference(api);

builder.Build().Run();
`;
---

<Pivot id="csharp">
  <Code
    code={csharp}
    lang="cs"
    title="AppHost.cs"
    mark={mark}
    collapse={collapse}
    collapseStyle={'collapsible-auto'}
  />
</Pivot>
<Pivot id="python">
  <Code
    code={python}
    lang="cs"
    title="AppHost.cs"
    mark={mark}
    collapse={collapse}
    collapseStyle={'collapsible-auto'}
  />
</Pivot>
<Pivot id="nodejs">
  <Code
    code={javascript}
    lang="cs"
    title="AppHost.cs"
    mark={mark}
    collapse={collapse}
    collapseStyle={'collapsible-auto'}
  />
</Pivot>
<Pivot id="go">
  <Code
    code={golang}
    lang="cs"
    title="AppHost.cs"
    mark={mark}
    collapse={collapse}
    collapseStyle={'collapsible-auto'}
  />
</Pivot>
<Pivot id="java">
  <Code
    code={java}
    lang="cs"
    title="AppHost.cs"
    mark={mark}
    collapse={collapse}
    collapseStyle={'collapsible-auto'}
  />
</Pivot>
