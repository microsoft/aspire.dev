---
import { Code, Tabs, TabItem } from '@astrojs/starlight/components';
import type { MarkerDefinition } from '@astrojs/starlight/expressive-code';

export type MarkerValueType = MarkerDefinition | MarkerDefinition[] | undefined;
export type CollapseValueType = string | string[] | undefined;

interface CodeProps {
  mark?: MarkerValueType;
  collapse?: CollapseValueType;
}

const { mark, collapse } = Astro.props as CodeProps;

const csharp = `
var builder = DistributedApplication.CreateBuilder(args);

// Add database resource
var postgres = builder.AddPostgres("db")
    .AddDatabase("appdata")
    .WithDataVolume();

// Add API service and reference the database
var api = builder.AddProject<Projects.Api>("api")
    .WithReference(postgres)
    .WaitFor(postgres);

// Add frontend service and reference the API
builder.AddViteApp("frontend", "../frontend")
    .WithHttpEndpoint(env: "PORT")
    .WithReference(api);

builder.Build().Run();
`;

const python = `
var builder = DistributedApplication.CreateBuilder(args);

// Add database resource
var postgres = builder.AddPostgres("db")
    .AddDatabase("appdata")
    .WithDataVolume();

// Add API service and reference the database
var api = builder.AddUvicornApp("api", "../api", "main:app")
    .WithUv().WithReference(postgres)
    .WaitFor(postgres);

// Add frontend service and reference the API
builder.AddUvicornApp("frontend", "../frontend", "app:app")
    .WithUv().WithHttpEndpoint(env: "PORT")
    .WithReference(api);

builder.Build().Run();
`;

const javascript = `
var builder = DistributedApplication.CreateBuilder(args);

// Add database resource
var postgres = builder.AddPostgres("db")
    .AddDatabase("appdata")
    .WithDataVolume();

// Add API service and reference the database
var api = builder.AddNodeApp("api", "../api", "server.js")
    .WithNpm().WithReference(postgres)
    .WaitFor(postgres);

// Add frontend service and reference the API
builder.AddViteApp("frontend", "../frontend")
    .WithHttpEndpoint(env: "PORT")
    .WithReference(api);

builder.Build().Run();
`;
---

<Tabs syncKey="apphost-lang">
  <TabItem label=".NET API" icon="seti:c-sharp">
    <Code
      code={csharp}
      lang="cs"
      title="AppHost.cs"
      mark={mark}
      collapse={collapse}
      collapseStyle={'collapsible-auto'}
    />
  </TabItem>
  <TabItem label="Python API" icon="seti:python">
    <Code
      code={python}
      lang="cs"
      title="AppHost.cs"
      mark={mark}
      collapse={collapse}
      collapseStyle={'collapsible-auto'}
    />
  </TabItem>
  <TabItem label="Node.js API" icon="seti:javascript">
    <Code
      code={javascript}
      lang="cs"
      title="AppHost.cs"
      mark={mark}
      collapse={collapse}
      collapseStyle={'collapsible-auto'}
    />
  </TabItem>
</Tabs>
